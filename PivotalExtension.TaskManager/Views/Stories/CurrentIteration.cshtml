@model IEnumerable<PivotalTrackerDotNet.Domain.Story>
@{
    ViewBag.Title = "Current Iteration";
}
<h2>
    Current Iteration</h2>
<table class="mainTable">
    @foreach (var item in Model) {
        <tr class="story">
            <td class="storyCol">@item.Name
            </td>
            <td>
                @foreach (var task in item.Tasks) {
                    @Html.Partial("TaskDetails", task)
                }
            </td>
        </tr>
    }
</table>
<br />
<a href="#" onclick="SignUp(); return false;">Sign Up for Selected</a>
<script type="text/javascript">
$(function () {
    $('.mainTable').selectable({
        filter: 'div.task:not(.complete)',
    });
});

function SignUp() {
    initials = prompt('Enter your initials in AA/BB format (an empty string will clear existing assignment):', '');
    $('div.ui-selected').each(function() {
        if(initials != null) {
            var id = $(this).attr('id');
            var items = id.split('-');
            $.ajax({
                type: 'POST',
                url: '/Task/SignUp',
                data: 'projectId=' + items[0] + '&storyId=' + items[1] + '&id=' + items[2] + '&initials=' + initials,
                success : function(html) {
                            $('#' + id).replaceWith(html);
                         },
                error : function (xhr, ajaxOptions, thrownError){
                            alert(thrownError);
                        }   
            });
        }
    });
}
</script>
